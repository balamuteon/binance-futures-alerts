# Binance Futures Alerter (Мониторинг фьючерсов Binance)

Высокопроизводительное приложение на Go для отслеживания изменений цен на фьючерсах Binance (USDⓈ-M) и отправки уведомлений о значительных колебаниях. Проект построен на микросервисной архитектуре с использованием Kafka для обмена сообщениями между сервисами. Уведомления отображаются в реальном времени в веб-интерфейсе с возможностью быстрого перехода к графику монеты на TradingView.

## Архитектура

Проект состоит из трех независимых микросервисов:
* **Ingestor**: Подключается к WebSocket Binance, получает сырые данные о тикерах и отправляет их в топик Kafka.
* **Generator**: Читает сырые данные из Kafka, анализирует их на предмет аномальных скачков цен и, если находит, генерирует алерты в другой топик Kafka.
* **Gateway**: Читает алерты из Kafka и рассылает их клиентам через WebSocket для отображения в веб-интерфейсе.

## Основные Возможности

* **Микросервисная архитектура**: Надежная и масштабируемая система на базе Apache Kafka.
* **Анализ в реальном времени**: Отслеживание изменения цены каждого тикера по отношению к самой старой цене в скользящем минутном окне.
* **Гибкая настройка**: Возможность изменять порог срабатывания и период "затишья" для алертов.
* **Веб-интерфейс**:
    * Список последних алертов с автообновлением.
    * Кликабельные тикеры, ведущие на график `ticker_name.P` на TradingView.
    * Звуковое оповещение при получении нового алерта.
* **Контейнеризация**: Полная поддержка Docker и Docker Compose для легкого развертывания.
* **CI/CD**: Готовый pipeline на GitHub Actions для сборки и публикации Docker-образов.
* **Корректное завершение (Graceful Shutdown)**: Все сервисы корректно завершают работу, не теряя данные.

## Технологии

* **Бэкенд**: Go
    * `gorilla/websocket` для WebSocket-коммуникаций.
    * `segmentio/kafka-go` для взаимодействия с Kafka.
* **Брокер сообщений**: Apache Kafka (в контейнере Bitnami).
* **Фронтенд**: HTML, CSS, JavaScript (ванильный JS).
* **Контейнеризация**: Docker, Docker Compose.

## Структура Проекта

Проект имеет четкую структуру, разделяющую код по сервисам и областям ответственности.


## Установка и Запуск

### Требования
* Docker (версия 20.10 или выше).
* Docker Compose.

### Запуск с помощью Docker Compose

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <URL_вашего_репозитория>
    cd <имя_папки>
    ```

2.  **Настройте IP-адрес для Kafka:**
    В файле `deployments/docker-compose.yml` найдите строку `KAFKA_CFG_ADVERTISED_LISTENERS` и замените `localhost` на IP-адрес вашего компьютера в локальной сети. Это необходимо, чтобы `gateway` на другой машине мог подключиться к Kafka.

3.  **Сборка и запуск:**
    Все команды выполняются из **корневой директории** проекта.

    Для запуска локальной среды разработки выполните:
    ```bash
    docker-compose -f deployments/docker-compose.yml up --build
    ```
    * Флаг `-f` явно указывает путь к файлу конфигурации.
    * `--build` принудительно пересобирает образы, если в коде были изменения.

    Для запуска в "боевом" режиме (detached):
    ```bash
    docker-compose -f deployments/docker-compose-prod.yml up -d
    ```

4.  **Доступ к веб-интерфейсу:**
    Откройте в браузере `http://localhost:8080`.

## Конфигурация

Основные параметры приложения (URL WebSocket, порог для алертов и т.д.) находятся в файле `pkg/config/config.go`. Для изменения этих параметров отредактируйте файл и пересоберите Docker-образы.

### Мониторинг и Визуализация (Prometheus + Grafana)

Проект включает полноценный стек мониторинга для сбора и визуализации метрик в реальном времени.

#### Архитектура стека:

1.  **Gateway (Экспортёр)**: Сервис `gateway` собирает метрики о своей работе (количество клиентов, время ответа и т.д.) и предоставляет их по адресу `/metrics`.
2.  **Prometheus (Сборщик и Хранилище)**: Отдельный сервис, который периодически опрашивает `/metrics`, собирает данные и сохраняет их в свою временную базу данных.
3.  **Grafana (Визуализатор)**: Платформа для визуализации, которая подключается к Prometheus как к источнику данных и отображает их в виде красивых и понятных графиков на дашборде.

#### Предустановленный Дашборд

Проект поставляется с уже готовым дашбордом, который создается автоматически при первом запуске. На нем отображаются ключевые метрики:
* Текущее количество подключенных WebSocket-клиентов.
* Общее число отправленных алертов.
* Среднее время ответа HTTP-сервера.

#### Как посмотреть дашборд?

1.  Убедитесь, что все контейнеры запущены с помощью `docker-compose`.
2.  Откройте в браузере веб-интерфейс Grafana по адресу: **`http://localhost:3000`**.
3.  Используйте логин и пароль по умолчанию:
    * **Логин**: `admin`
    * **Пароль**: `admin`
    (Grafana попросит вас сменить пароль при первом входе).
4.  После входа перейдите в раздел **Dashboards** (иконка с четырьмя квадратами на панели слева). Вы сразу увидите готовый дашборд **"Binance Alerter Overview"**.

Для отладки вы также можете зайти в интерфейс Prometheus (`http://localhost:9090`) и на страницу метрик самого приложения (`http://localhost:8080/metrics`).